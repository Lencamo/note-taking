&emsp;&emsp;åœ¨ç¼–å†™è°ƒè¯• Node.js é¡¹ç›®çš„æ—¶å€™ï¼Œå¦‚æœä¿®æ”¹äº†ä»£ç ï¼Œåˆ™éœ€è¦é¢‘ç¹çš„æ‰‹åŠ¨ close æ‰ï¼Œç„¶åå†é‡å¯ï¼Œéå¸¸ç¹çã€‚

&emsp;å½“å‰ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ nodemon æˆ– node-dev è§£å†³è¿™ä¸€é—®é¢˜ï¼š

```sh
1ã€å®‰è£…
npm i nodemon -g

2ã€ä½¿ç”¨
nodemon <æ–‡ä»¶å>
```

## ä¸€ã€Node.js å†…ç½®æ¨¡å—ï¼ˆä¸Šï¼‰

### 1ã€fs æ¨¡å—

&emsp;&emsp;å…·ä½“å†…å®¹æŸ¥çœ‹ [Node çš„ API æ–‡æ¡£](http://nodejs.cn/api/)ï¼Œä¸‹é¢ç®€å•åˆ—ä¸¾å‡ ä¸ªç¤ºä¾‹ï¼š

- Promise çš„ API

```js
const fs = require('fs').promises
```

- å›è°ƒï¼ˆå¼‚æ­¥ï¼‰çš„ API

```js
const fs = require('fs')
```

- åŒæ­¥çš„ API âœ¨

```js
ã€åœ¨åŒæ­¥æ–¹æ³•çš„åŸºç¡€ä¸Šåé¢åŠ Syncã€‘
```

â‘  æ¡ˆä¾‹ 1ï¼šè¯»å–æ–‡ä»¶

```js
// 1ã€åŒæ­¥è¯»å–
try {
  const content = fs.readFileSync('logs/log-1.txt', 'utf-8')
  console.log(content)
  console.log(0)
} catch (e) {
  console.log(e.message)
}

// 2ã€å¼‚æ­¥è¯»å–
// æ–¹å¼ä¸€
fs.readFile('./logs/log-0.txt', 'utf-8', (err, content) => {
  console.log(content)
  console.log(0)
})
console.log(1)

// æ–¹å¼äºŒ ğŸš©
const fs = require('fs').promises

fs.readFile('./log/log-0.txt', 'utf-8').then((result) => {
  console.log(result)
})
```

â‘¡ æ¡ˆä¾‹ 2ï¼šåˆ é™¤æ–‡ä»¶

> é‡ç‚¹ï¼šå¾ªç¯ä¸­çš„å¼‚æ­¥ä¸åŒæ­¥

æ–¹å¼ä¸€

```js
const fs = require('fs')

fs.readdir('./file', (err, data) => {
  data.forEach((item) => {
    // åŒæ­¥çš„æ–¹å¼
    fs.unlinkSync(`./file/${item}`)
  })

  fs.rmdir('./file', (err) => {
    console.log(err)
  })
})
```

æ–¹å¼äºŒ

```js
const fs = require('fs').promises

fs.readdir('./file',(err,data)=>{
  // let arr = []
  // data.forEach(item=>{
  //   arr.push(fs.unlink(`./file/${item}`))
  // })
  // await Promise.all(arr)

  // æˆ–è€…
  await Promise.all(data.map(item=>fs.unlink(`./file/${item}`)))

  await fs.rmdir('./file')
})
```

â‘¢ æ¡ˆä¾‹ï¼šæ—¶é’Ÿæ¡ˆä¾‹ï¼ˆè‡ªå·±å°è¯•ï¼‰

æç¤ºï¼š

```js
const cssRegex = /<style>[\s\S]*<\/style>/ // æ­£åˆ™è¡¨è¾¾å¼
const jsRegex = /<script>[\s\S]*<\/script>/
```

### 2ã€path æ¨¡å—

&emsp;&emsp;å…·ä½“å†…å®¹æŸ¥çœ‹[Node.js å…¥é—¨æ•™ç¨‹](http://nodejs.cn/learn)ã€‚

â‘  å¸¸è§çš„æœ‰ï¼š

- path.join()
- path.dirname()
- path.basename()
- path.extname()

> path.parse

```js
require('path').parse('/users/test.txt')

ç»“æœä¸ºï¼š
{
  root: '/',
  dir: '/users',
  base: 'test.txt',
  ext: '.txt',
  name: 'test'
}
```

â‘¡ è·å–æ–‡ä»¶çš„ç»å¯¹ âœ¨ è·¯å¾„ï¼š

```js
// æ–¹å¼1
const lessPath = path.join(__dirname, '/src/styles/vant-cover.less')

// æ–¹å¼2
const lessPath = path.resolve('src/styles/vant-cover.less')
```

### 3ã€http æ¨¡å—

ç®€å†™å½¢å¼

```js
const http = require('http')

// åˆ›å»ºå¹¶å¼€å¯webæœåŠ¡å™¨
http
  .createServer((req, res) => {
    //åˆ©ç”¨å›è°ƒå‡½æ•°å®ç°ï¼šä»æµè§ˆå™¨æ¥æ”¶æ•°æ®ï¼Œå¹¶å‘å…¶å“åº”æ•°æ®
    res.write(`
      <html>
        <b>hello boys!</b>
      </html>
    `)
    res.end()
  })
  .listen(8080, '127.0.0.1', () => {
    console.log('Server running at http://127.0.0.1:8080')
  })
```

å…·ä½“å½¢å¼

```js
// 1ã€å¯¼å…¥httpæ¨¡å—
const http = require('http')

// 2ã€åˆ›å»ºwebæœåŠ¡å™¨å®ä¾‹
const server = http.createServer()

// 3ã€ä¸ºæœåŠ¡å™¨å®ä¾‹ç»‘å®šrequestäº‹ä»¶ï¼Œç›‘å¬å®¢æˆ·ç«¯ğŸš©çš„è¯·æ±‚
server.on('request', (req, res) => {
  //åˆ©ç”¨å›è°ƒå‡½æ•°å®ç°ï¼šä»æµè§ˆå™¨æ¥æ”¶æ•°æ®ï¼Œå¹¶å‘å…¶å“åº”æ•°æ®
  res.end(`<h2>hello boys!</h2>`)
})

// 4ã€å¯åŠ¨æœåŠ¡å™¨
server.listen(8080, '127.0.0.1', () => {
  console.log('Server running at http://127.0.0.1:8080')
})
```

> é»˜è®¤çš„å†™æœ‰æœ‰ï¼šres.writeHead(200, { 'Content-Type': 'text/html;charset=utf-8' })

å¸¸è§çš„ req ä¸ res å†…å®¹ï¼š
â‘  req

- req.urlï¼ˆâœ¨url åç¼€å†…å®¹ï¼‰
- req.method

â‘¡ res

- res.write
- res.writeHead ï¼ˆå®ƒ<span style="color:red;">å¿…é¡»å†™åœ¨ res.write çš„å‰é¢ï¼Œä¸ç„¶ä¼šæŠ¥é”™ ğŸ˜­</span>ï¼‰

> 'Content-Type': application/json;charset=utf-8'
> 'Content-Type': text/html;charset=utf-8'
> 'Content-Type': text/plain;charset=utf-8'

### 4ã€url æ¨¡å—ï¼ˆæ—§ç‰ˆï¼‰

#### urlObject

```js
const urlObject = {
  protocol: 'https:',
  slashes: true,
  auth: null,
  host: 'www.baidu.com:443',
  port: '443',
  hostname: 'www.baidu.com',
  hash: '#tag=110',
  search: '?id=8&name=mouse',
  // query: 'id=8&name=mouse', å­—ç¬¦ä¸²æ ¼å¼
  query: [Object: null prototype] { id: '8', name: 'mouse' }, // JSONæ•°æ®æ ¼å¼
  pathname: '/ad/index.html',
  path: '/ad/index.html?id=8&name=mouse',
  href: 'https://www.baidu.com:443/ad/index.html?id=8&name=mouse#tag=110'
}
```

- parse

```js
var url = require('url')

server.on('request', (req, res) => {
  const urlName =
    'https://www.baidu.com:443/ad/index.html?id=8&name=mouse#tag=110'

  // åŠ å…¥trueå‚æ•°åï¼ŒurlObject.query æ•°æ®ä¸ºğŸš©jsonæ ¼å¼ï¼›é»˜è®¤ urlObject.query æ•°æ®ä¸ºå­—ç¬¦ä¸²æ ¼å¼
  // const urlObject = url.parse(urlName)
  const urlObject = url.parse(urlName, true)
  console.log(urlObject)

  res.end()
})
```

- format

```js
var url = require('url')

server.on('request', (req, res) => {
  const urlName = url.format(urlObject)
  console.log(urlName)

  res.end()
})
```

- resolve ğŸš©

> å¯¹ åŸŸååé¢çš„è·¯å¾„è¿›è¡Œå¤„ç†

```js
var url = require('url')

// âœ¨æ¼”ç¤ºï¼ˆå‰é¢çš„æœ«å°¾åŠ '/',åé¢çš„å¼€å¤´ä¸åŠ '/' â€”â€”> æ‹¼æ¥ï¼‰
url.resolve('/one/two/', 'three') // '/one/two/three'
url.resolve('http://example.com/one/two/', 'three') // 'http://example.com/one/two/three'

// æ¼”ç¤ºï¼ˆæ›¿æ¢æœ«å°¾çš„è·¯å¾„ï¼‰
url.resolve('/one/two', 'three') // '/one/three'
url.resolve('http://example.com/one/two', 'three') // 'http://example.com/one/three'

// âœ¨æ¼”ç¤ºï¼ˆåé¢çš„åŠ '/' â€”â€”> æ›¿æ¢æ‰€æœ‰ï¼‰
url.resolve('/one/two/', '/three') // '/three'
url.resolve('http://example.com/one/two/', '/three') // 'http://example.com/three'
```

### 5ã€url æ¨¡å—ï¼ˆæ–°ç‰ˆï¼‰

&emsp;&emsp;æ›´å¤šåŠŸèƒ½æŸ¥çœ‹å®˜æ–¹ api æ–‡æ¡£ï¼Œè‡ªå­¦ã€‚

> [api æ–‡æ¡£](http://nodejs.cn/api/)

#### URL

```js
URL {
  href: 'https://www.baidu.com/ad/index.html?id=8&name=mouse#tag=110',
  origin: 'https://www.baidu.com',
  protocol: 'https:',
  username: '',
  password: '',
  host: 'www.baidu.com',
  hostname: 'www.baidu.com',
  port: '',
  pathname: '/ad/index.html',
  search: '?id=8&name=mouse',
  //ä¸åŒäºæ—§ç‰ˆæœ¬queryï¼Œå®ƒçš„å‚æ•°æ˜¯è¿­ä»£âœ¨å¯¹è±¡çš„å½¢å¼
  searchParams: URLSearchParams { 'id' => '8', 'name' => 'mouse' },
  hash: '#tag=110'
}
```

```js
var url = require('url')

server.on('request', (req, res) => {
  // ç±»ä¼¼äºæ—§ç‰ˆçš„parseã€resolveä½œç”¨
  const URL = new URL(
    '/ad/index.html?id=8&name=mouse#tag=110',
    'https://www.baidu.com:443/'
  )
  console.log(URL)

  res.end()
})
```

### 6ã€querystring æ¨¡å—

&emsp;&emsp;å‰é¢æˆ‘ä»¬æ¥è§¦çš„ <span style="background-color:yellow;color:black;">è·¯å¾„å‚æ•°</span> çš„å½¢å¼æœ‰é»˜è®¤çš„å­—ç¬¦ä¸²å½¢å¼ã€JSON æ•°æ®æ ¼å¼ã€è¿­ä»£å¯¹è±¡å½¢å¼ã€‚ç°åœ¨æ¥è§¦ querystring æ¨¡å—å¯¹è·¯å¾„å‚æ•°éƒ¨åˆ†è¿›è¡Œå¤„ç†ã€‚

```js
const querystring = require('querystring')

server.on('request', (req, res) => {
  // 1ã€parseæ–¹æ³•âœ¨
  const queryStr1 = 'name=lencamo&age=20'

  const queryObj1 = querystring.parse(queryStr1)
  console.log(queryObj1)

  // 2ã€stringifyæ–¹æ³•âœ¨
  const queryObj2 = {
    name: 'lencamo',
    age: '20'
  }
  const queryStr2 = querystring.stringify(queryObj2)
  console.log(queryStr2)

  // 3ã€ç™¾åˆ†æ¯”ç¼–ç ï¼ˆå®‰å…¨æ€§è§’åº¦ï¼‰
  const queryStr = 'name=å­—æ¯å“¥&age=26'

  const escaped = querystring.escape(queryStr)
  console.log(escaped)

  const unescaped = querystring.unescape(escaped)
  console.log(unescaped)

  res.end()
})
```

## äºŒã€HTTP æœåŠ¡å™¨

### 1ã€æ¡ˆä¾‹æ¼”ç¤º

&emsp;&emsp;è‡ªå®šä¹‰æ ¹æ®åœ°å€è·å–ä¸åŒçš„å†…å®¹ï¼ˆHTTP å“åº”ã€é¡µé¢å†…å®¹å“åº”ç­‰ç­‰ï¼‰

- server.js

```js
var http = require('http')
var url = require('url')

const A = require('./A')
const B = require('./B')

// åˆ›å»ºwebæœåŠ¡å™¨
http
  .createServer((req, res) => {
    const pathName = url.parse(req.url).pathname

    res.writeHead(B.renderStatus(pathName), {
      'Content-Type': 'text/html;charset=utf-8'
    })
    res.write(A.renderHTML(pathName))
    res.end()
  })
  .listen(3000, '127.0.0.1', function () {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

- A.js

```js
function renderHTML(url) {
  switch (url) {
    case '/home':
      // è¿”å›htmlå­—ç¬¦ä¸²
      return `<html><h3>é¦–é¡µ</h3></html>`
    case '/api/cart':
      // è¿”å›æ•°ç»„
      return `["foods1","foods2","foods3"]`
    case '/api/owner':
      // è¿”å›jsonæ•°æ®
      return `{name:"kerwin"}`
    default:
      return `<html><p>404 not found</p></html>`
  }
}

module.exports = {
  renderHTML
}
```

- B.js

```js
function renderStatus(url) {
  var arr = ['/home', '/cart', '/owner', '/api/cart', '/api/owner']
  return arr.includes(url) ? 200 : 404
}

exports.renderStatus = renderStatus
```

### 2ã€æ¥å£è·¨åŸŸé—®é¢˜

&emsp;&emsp;ä¸Šé¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿”å›çš„éƒ½æ˜¯ä¸€äº›çº¯ html å­—ç¬¦ä¸²ï¼Œå½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥å‘å‰ç«¯è¿”å›çš„ jsonpã€‚

- jsonp
- cors
- â€¦â€¦
