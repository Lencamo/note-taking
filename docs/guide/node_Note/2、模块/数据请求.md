&emsp;&emsp;ä¸‹é¢çš„æ‰€æœ‰æ•°æ®è¯·æ±‚æ–¹å¼éƒ½ä¸ºï¼šå¼‚æ­¥ï¼ˆasyncï¼‰æ–¹å¼æ‰§è¡Œã€‚

## AJAX

&emsp;&emsp;AJAX å…¨ç§°æ˜¯"Asynchronous JavaScript and XML"(å¼‚æ­¥ Javascript å’Œ XML)ï¼Œæ˜¯ä¸€ç§åˆ›å»ºäº¤äº’å¼ç½‘é¡µåº”ç”¨çš„ç½‘é¡µå¼€å‘æŠ€æœ¯ã€‚

## ä¸€ã€XHR æ–¹å¼

&emsp;&emsp;XMLHttpRequestï¼ˆç®€ç§° xhrï¼‰æ˜¯æµè§ˆå™¨æä¾›çš„ JavaScript å¯¹è±¡ï¼Œé€šè¿‡å®ƒå¯ä»¥è¯·æ±‚æœåŠ¡å™¨ä¸Šçš„æ•°æ®èµ„æºã€‚

> åŒæ­¥æ‰§è¡Œï¼šxhr.open('GET',url,false)

- get è¯·æ±‚

```html
<body>
  <script>
    // 1ã€åˆ›å»ºxhrå¯¹è±¡
    var xhr = new XMLHttpRequest()

    // 2ã€å‘ç”Ÿgetè¯·æ±‚
    xhr.open('GET', 'http://www.liulongbin.top:3006/api/getbooks?id=1')
    xhr.send()

    // ç›‘å¬äº‹ä»¶
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        // 3ã€è·å–å“åº”æ•°æ®
        console.log(xhr.responseText)
      }
    }
  </script>
</body>
```

- post è¯·æ±‚

```html
<body>
  <script>
    // 1ã€åˆ›å»ºxhrå¯¹è±¡
    var xhr = new XMLHttpRequest()

    // 2ã€å‘ç”Ÿpostè¯·æ±‚
    xhr.open('POST', 'http://www.liulongbin.top:3006/api/addbook')

    xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded')
    xhr.send('bookname=æ°´æµ’ä¼ &author=æ–½è€åºµ&publisher=ä¸Šæµ·å›¾ä¹¦å‡ºç‰ˆç¤¾')
    // æˆ–è€…
    // xhr.setRequestHeader('Content-Type', 'application/json')
    // xhr.send(JSON.stringify({
    //   bookname: 'æ°´æµ’ä¼ 1',
    //   author: 'æ–½è€åºµ1',
    //   publisher: 'ä¸Šæµ·å›¾ä¹¦å‡ºç‰ˆç¤¾1'
    // }))

    // ç›‘å¬äº‹ä»¶
    xhr.onreadystatechange = function () {
      if (xhr.readyState === 4 && xhr.status === 200) {
        // 3ã€è·å–å“åº”æ•°æ®
        console.log(xhr.responseText)
      }
    }
  </script>
</body>
```

## ä¸‰ã€Ajax çš„æ–¹å¼

### 1ã€åŸç”Ÿ js

&emsp;&emsp;è¦æƒ³ä½¿ç”¨ ajaxï¼Œé¦–å…ˆå¾—å…ˆå°è£… ajax å‡½æ•°ã€‚

> ç•¥ï¼ˆéƒ½è¦æ‰‹åŠ¨å°è£…äº†ï¼Œè¿˜æœ‰å¿…è¦ä½¿ç”¨å—ï¼Ÿï¼‰

### 2ã€jQuery çš„ ajax å‡½æ•°

&emsp;&emsp;jQuery ä¸­çš„ Ajax å‡½æ•°ï¼Œæ˜¯åŸºäº xhr å¯¹è±¡å°è£…å‡ºæ¥çš„ã€‚

ä½¿ç”¨æ¨¡æ¿ï¼š

```js
$.ajax({
  type: '',
  url: '',
  // getå’Œpostè¯·æ±‚éƒ½ğŸ’–ç”¨data
  data: {},
  success: function () {},
  error: function () {}
})
```

- get è¯·æ±‚

```html
<body>
  <script src="./lib/jquery.min.js"></script>
  <script>
    $.ajax({
      type: 'GET',
      url: 'http://www.liulongbin.top:3006/api/getbooks',
      data: { id: 1 },
      success: function (res) {
        console.log(res)
      }
    })
  </script>
</body>
```

- post è¯·æ±‚

```html
<body>
  <script src="./lib/jquery.min.js"></script>
  <script>
    $.ajax({
      type: 'POST',
      url: 'http://www.liulongbin.top:3006/api/addbook',
      data: {
        bookname: 'æ°´æµ’ä¼ ',
        author: 'æ–½è€åºµ',
        publisher: 'ä¸Šæµ·å›¾ä¹¦å‡ºç‰ˆç¤¾'
      },
      success: function (res) {
        console.log(res)
      }
    })
  </script>
</body>
```

## ä¸‰ã€Fetch æ–¹å¼ ğŸŒˆ

&emsp;&emsp;fetch æ˜¯ä¸€ç§ HTTP æ•°æ®è¯·æ±‚çš„æ–¹å¼ï¼Œæ˜¯ XMLHttpRequest çš„ä¸€ç§æ›¿ä»£æ–¹æ¡ˆã€‚

> å½“æˆ‘ä»¬åœ¨å‘é€å¸¦æœ‰è¯·æ±‚çš„ body æ—¶ï¼Œéœ€è¦å¯¹æ•°æ®è¿›è¡Œå­—ç¬¦ä¸²åŒ–ï¼›è€Œåœ¨ axios ä¸­ï¼Œå®ƒæ˜¯è‡ªåŠ¨å®Œæˆçš„

ä½¿ç”¨æ¨¡æ¿ï¼š

```js
fetch(url[, options])
  .then((res) =>
    // handle response
  )
  .catch((error) => {
    // handle error
  })
```

æ•°æ®å“åº”æ ¼å¼ï¼š

- response.json()
- response.text()
- response.formData()
- response.blob()
- response.arrayBuffer()

â‘  get è¯·æ±‚

```html
<body>
  <script>
    fetch('http://www.liulongbin.top:3006/api/getbooks?id=1')
      // jsonæ ¼å¼åŒ–
      .then((res) => res.json())
      .then((res) => {
        //è¾“å‡ºå“åº”æ•°æ®
        console.log(res)
      })
  </script>
</body>
```

â‘¡ post è¯·æ±‚

```html
<script>
  fetch('http://www.liulongbin.top:3006/api/addbook', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    // å­—ç¬¦ä¸²åŒ–
    body: JSON.stringify({
      bookname: 'æ°´æµ’ä¼ ',
      author: 'æ–½è€åºµ',
      publisher: 'ä¸Šæµ·å›¾ä¹¦å‡ºç‰ˆç¤¾'
    })
    // æˆ–è€…
    // headers: {
    //   'Content-Type': 'application/json'
    // },
    // body: "bookname=æ°´æµ’ä¼ &author=æ–½è€åºµ&publisher=ä¸Šæµ·å›¾ä¹¦å‡ºç‰ˆç¤¾"
  })
    // jsonæ ¼å¼åŒ–
    .then((response) => response.json())
    .then((res) => {
      console.log(res)
    })
    .catch((error) => console.log(error))
</script>
```

## å››ã€axios çš„æ–¹å¼

&emsp;&emsp;[Axios](https://www.axios-http.cn/) æ˜¯ä¸€ä¸ªåŸºäº promise ç½‘ç»œè¯·æ±‚åº“ï¼Œä½œç”¨äº node.js å’Œæµè§ˆå™¨ä¸­ã€‚

- åœ¨æœåŠ¡ç«¯å®ƒä½¿ç”¨åŸç”Ÿ node.js http æ¨¡å—,
- è€Œåœ¨å®¢æˆ·ç«¯ (æµè§ˆç«¯) åˆ™ä½¿ç”¨ XMLHttpRequestsã€‚

ä½¿ç”¨æ¨¡æ¿ï¼š

```js
// é»˜è®¤ä¸ºaxios.get
axios(url[,options])
  .then((res) =>
    // handle response
  )
  .catch((error) => {
    // handle error
  })
```

promise å“åº”ï¼ˆresï¼‰å¯¹è±¡ï¼š

- data ğŸ‘€
- status
- statusText
- headers
- config
- request

å®šä¹‰æ—¶çš„å¸¸ç”¨å±æ€§ï¼š

- url
- baseURL
- method
- params
- data
- responseType ï¼ˆé»˜è®¤è‡ªåŠ¨å“åº”çš„æ˜¯ json æ•°æ®ï¼‰
- timeout ï¼ˆé»˜è®¤å€¼ä¸º 0ï¼Œå³æ°¸ä¸è¶…æ—¶ï¼‰
- proxy

â‘  get è¯·æ±‚

```html
<body>
  <script src="./lib/axios.min.js"></script>
  <script>
    async function axios_get() {
      const { data: res } = await axios({
        method: 'GET',
        url: 'http://www.liulongbin.top:3006/api/getbooks',

        //getè¯·æ±‚urlä¸­çš„æŸ¥è¯¢å‚æ•° â€”â€” âœ¨params
        params: { id: 1 }
      })
      console.log(res)
    }

    axios_get()
  </script>
</body>
```

â‘¡ post è¯·æ±‚

```html
<body>
  <script src="./lib/axios.min.js"></script>
  <script>
    async function axiso_post() {
      const { data: res } = await axios({
        method: 'POST',
        url: 'http://www.liulongbin.top:3006/api/addbook',

        //postè¯·æ±‚ï¼šè¯·æ±‚ä½“å‚æ•° â€”â€” âœ¨data
        data: {
          bookname: 'æ°´æµ’',
          author: 'æ–½è€åºµ',
          publisher: 'ä¸Šæµ·å›¾ä¹¦å‡ºç‰ˆç¤¾'
        }
      })
      console.log(res)
    }

    axiso_post()
  </script>
</body>
```

## å…­ã€æ€»ç»“

&emsp;&emsp;å½“ç„¶ï¼Œä¸Šè¿°æˆ‘åªæ˜¯ç®€å•çš„ç½—åˆ—äº†ç›¸å…³å†…å®¹ã€‚æ›´å¤šçš„å†…å®¹å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ç­‰å­¦ä¹ ï¼Œå½“ç„¶ä¸ªäººå»ºè®®æ˜¯é‡åˆ°å…·ä½“çš„åº”ç”¨åœºæ™¯å»å­¦ä¹ å…·ä½“çš„å†…å®¹ã€‚

> å¦‚ï¼šaxiso æ‹¦æˆªå™¨ç­‰ç­‰

- åœ¨è¯·æ±‚æˆ–å“åº”è¢« then æˆ– catch å¤„ç†å‰æ‹¦æˆªå®ƒä»¬ã€‚

```js
// æ·»åŠ è¯·æ±‚æ‹¦æˆªå™¨
axios.interceptors.request.use(
  function (config) {
    // åœ¨å‘é€è¯·æ±‚ä¹‹å‰åšäº›ä»€ä¹ˆ
    return config
  },
  function (error) {
    // å¯¹è¯·æ±‚é”™è¯¯åšäº›ä»€ä¹ˆ
    return Promise.reject(error)
  }
)

// æ·»åŠ å“åº”æ‹¦æˆªå™¨
axios.interceptors.response.use(
  function (response) {
    // 2xx èŒƒå›´å†…çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚
    // å¯¹å“åº”æ•°æ®åšç‚¹ä»€ä¹ˆ
    return response
  },
  function (error) {
    // è¶…å‡º 2xx èŒƒå›´çš„çŠ¶æ€ç éƒ½ä¼šè§¦å‘è¯¥å‡½æ•°ã€‚
    // å¯¹å“åº”é”™è¯¯åšç‚¹ä»€ä¹ˆ
    return Promise.reject(error)
  }
)
```

- ç§»é™¤æ‹¦æˆªå™¨

```js
const myInterceptor = axios.interceptors.request.use(function () {
  /*...*/
})
axios.interceptors.request.eject(myInterceptor)
```

- ç»™è‡ªå®šä¹‰çš„ axios å®ä¾‹æ·»åŠ æ‹¦æˆªå™¨

```js
const instance = axios.create()
instance.interceptors.request.use(function () {
  /*...*/
})
```
