## åŒæºä¸è·¨åŸŸ

&emsp;&emsp;å¦‚æœä¸¤ä¸ª URL çš„<span style="color:green;">åè®®ã€åŸŸåã€ç«¯å£</span>éƒ½ä¸€è‡´ï¼Œåˆ™ä»–ä»¬<span style="color:red;">åŒæº</span>ï¼Œåä¹‹æ˜¯è·¨åŸŸã€‚

## åŒæºç­–ç•¥

&emsp;&emsp;å‡ºç°è·¨åŸŸçš„æ ¹æœ¬åŸå› ï¼š

> æµè§ˆå™¨çš„åŒæºç­–ç•¥ä¸å…è®¸éåŒæºçš„ URL ä¹‹é—´è¿›è¡Œèµ„æºçš„äº¤äº’ã€‚

<img src="https://deer-sir.oss-cn-chengdu.aliyuncs.com/note-taking/20220611233328.png" width=575px />

## ä¸€ã€JONSP æ–¹å¼ï¼ˆå‰ç«¯è§£å†³ï¼‰

&emsp;&emsp;ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œç½‘é¡µ<span style="color:green;">æ— æ³•é€šè¿‡ ajax è¯·æ±‚éåŒæºçš„æ¥å£æ•°æ®</span>ã€‚ä½†æ˜¯ï¼š

> script æ ‡ç­¾çš„ src å±æ€§ã€img æ ‡ç­¾çš„ src å±æ€§ã€link æ ‡ç­¾çš„ href å±æ€§ç­‰æ˜¯æ²¡æœ‰è·¨åŸŸçš„é™åˆ¶çš„ã€‚

### åŸç†ï¼š

&emsp;&emsp;åŠ¨æ€æ·»åŠ ä¸€ä¸ª\<script>æ ‡ç­¾ï¼Œé€šè¿‡ src å±æ€§è¯·æ±‚è·¨åŸŸçš„æ•°æ®æ¥å£ï¼Œå¹¶é€šè¿‡å‡½æ•°è°ƒç”¨çš„å½¢å¼æ¥å—è·¨åŸŸæ¥å£å“åº”å›æ¥çš„æ•°æ®ã€‚

### ç¼ºç‚¹ï¼š

&emsp;&emsp;åªèƒ½è§£å†³ get è¯·æ±‚çš„è·¨åŸŸé—®é¢˜ã€‚

### â‘  å‰ç«¯

- åŸç”Ÿ js æ–¹å¼

```html
<body>
  <script>
    var scriptTag = document.createElement('script')
    // å¯ä»¥è‡ªå®šä¹‰callbackå‡½æ•°çš„å‡½æ•°å
    scriptTag.src = 'http://127.0.0.1:3000/api/list?callback=listBack'
    document.body.appendChild(scriptTag)

    function listBack(obj) {
      console.log(obj)
    }
  </script>
</body>
```

- jQuery æ–¹å¼

```html
<body>
  <script src="./lib/jquery.min.js"></script>
  <script>
    $(function () {
      $.ajax({
        dataType: 'jsonp',
        url: 'http://127.0.0.1:3000/api/list',
        // å¯ä»¥è‡ªå®šä¹‰ğŸš©callbackå‡½æ•°çš„å‡½æ•°å
        jsonp: 'callback',
        jsonpCallback: 'listBack',

        // æºå¸¦çš„å‚æ•°
        data: {},

        success: function (res) {
          console.log(res)
        }
      })
    })
  </script>
</body>
```

### â‘¡ åç«¯

- Node.js æ–¹å¼

```js
const http = require('http')
const url = require('url')

// åˆ›å»ºwebæœåŠ¡å™¨
http
  .createServer((req, res) => {
    // è·å–å‰ç«¯å®šä¹‰çš„callbackåç§°
    const urlobj = url.parse(req.url, true)

    callbackName = urlobj.query.callback
    // æ ¹æ®å‰ç«¯çš„éœ€æ±‚ç¼–å†™æ¥å£
    switch (urlobj.pathname) {
      case '/api/list':
        // ä½¿ç”¨åŠ¨æ€è¿”å›ğŸš©çš„å‡½æ•°å
        res.end(
          `${callbackName}(${JSON.stringify({
            name: 'phone',
            price: 4999
          })})`
        )
        break
      default:
        res.end('404')
        break
    }
  })
  .listen(3000, '127.0.0.1', () => {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

## äºŒã€CORS æ–¹å¼ï¼ˆåç«¯è§£å†³ï¼‰

### â‘  å‰ç«¯

&emsp;&emsp;ç”±äºé€šè¿‡ CORS çš„æ–¹å¼ï¼Œåç«¯å·²ç»è§£å†³äº†è·¨åŸŸé—®é¢˜ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸ç”¨é€šè¿‡\<script>æ ‡ç­¾çš„ src å±æ€§æ¥è°ƒç”¨æ¥å£ã€‚

> æ­¤æ—¶ç›´æ¥ä½¿ç”¨ ajax çš„æ–¹å¼å°±å¯ä»¥è°ƒç”¨æ¥å£æ•°æ®äº†ï¼Œä¸‹é¢å°±ä½¿ç”¨å¸¸ç”¨çš„ axios æ¥è¯·æ±‚æ•°æ®å§ã€‚

- fetch æ–¹å¼

```html
<body>
  <script>
    fetch('http://127.0.0.1:3000/api/list?id=1')
      // jsonæ ¼å¼åŒ–
      .then((res) => res.json())
      .then((res) => {
        //è¾“å‡ºå“åº”æ•°æ®
        console.log(res)
      })
  </script>
</body>
```

- axios æ–¹å¼

```html
<body>
  <script src="./lib/axios.min.js"></script>
  <script>
    async function axios_get() {
      const { data: res } = await axios({
        method: 'GET',
        url: 'http://127.0.0.1:3000/api/list',
        //getè¯·æ±‚urlä¸­çš„æŸ¥è¯¢å‚æ•° â€”â€” âœ¨params
        params: { id: 1 }
      })
      console.log(res)
    }

    axios_get()
  </script>
</body>
```

### â‘¡ åç«¯

- Node.js

```js
const http = require('http')
const url = require('url')

// åˆ›å»ºwebæœåŠ¡å™¨
http
  .createServer((req, res) => {
    // è·å–å‰ç«¯å®šä¹‰çš„callbackåç§°
    const urlobj = url.parse(req.url, true)

    callbackName = urlobj.query.callback

    res.writeHead(200, {
      'content-type': 'application',
      // è·¨åŸŸé—®é¢˜è§£å†³æ–¹æ¡ˆï¼šCORSğŸš©å¤´
      'Access-Control-Allow-Origin': '*'
    })

    // æ ¹æ®å‰ç«¯çš„éœ€æ±‚ç¼–å†™æ¥å£
    switch (urlobj.pathname) {
      case '/api/list':
        // ç›´æ¥âœ¨è¿”å›JSONæ•°æ®
        res.end(
          `(${JSON.stringify({
            name: 'phone',
            price: 4999
          })})`
        )
        break
      default:
        res.end('404')
        break
    }
    res.end()
  })
  .listen(3000, '127.0.0.1', () => {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

## ä¸‰ã€express ä¸­çš„è·¨åŸŸé—®é¢˜

1ã€å®‰è£… cors ä¸­é—´ä»¶

> npm i cors -S

2ã€ä½¿ç”¨ cors ä¸­é—´ä»¶

```JavaScript
const cors = require('cors')
app.use(cors())
```
