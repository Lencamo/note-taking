## åŒæºä¸è·¨åŸŸ

&emsp;&emsp;å¦‚æœä¸¤ä¸ª URL çš„<span style="color:green;">åè®®ã€åŸŸåã€ç«¯å£</span>éƒ½ä¸€è‡´ï¼Œåˆ™ä»–ä»¬<span style="color:red;">åŒæº</span>ï¼Œåä¹‹æ˜¯è·¨åŸŸã€‚

## åŒæºç­–ç•¥

&emsp;&emsp;å‡ºç°è·¨åŸŸçš„æ ¹æœ¬åŸå› ï¼š

> æµè§ˆå™¨çš„åŒæºç­–ç•¥ä¸å…è®¸éåŒæºçš„ URL ä¹‹é—´è¿›è¡Œèµ„æºçš„äº¤äº’ã€‚

<img src="https://deer-sir.oss-cn-chengdu.aliyuncs.com/note-taking/20220611233328.png" width=575px />

## ä¸€ã€JONSP æ–¹å¼ï¼ˆå‰ç«¯è§£å†³ï¼‰

&emsp;&emsp;ç”±äºæµè§ˆå™¨çš„åŒæºç­–ç•¥ï¼Œç½‘é¡µ<span style="color:green;">æ— æ³•é€šè¿‡ ajax è¯·æ±‚éåŒæºçš„æ¥å£æ•°æ®</span>ã€‚ä½†æ˜¯ï¼š

> script æ ‡ç­¾çš„ src å±æ€§ã€img æ ‡ç­¾çš„ src å±æ€§ã€link æ ‡ç­¾çš„ href å±æ€§ç­‰æ˜¯æ²¡æœ‰è·¨åŸŸçš„é™åˆ¶çš„ã€‚

### åŸç†ï¼š

&emsp;&emsp;åŠ¨æ€æ·»åŠ ä¸€ä¸ª\<script>æ ‡ç­¾ï¼Œé€šè¿‡ src å±æ€§è¯·æ±‚è·¨åŸŸçš„æ•°æ®æ¥å£ï¼Œå¹¶é€šè¿‡å‡½æ•°è°ƒç”¨çš„å½¢å¼æ¥å—è·¨åŸŸæ¥å£å“åº”å›æ¥çš„æ•°æ®ã€‚

### ç¼ºç‚¹ï¼š

&emsp;&emsp;åªèƒ½è§£å†³ get è¯·æ±‚çš„è·¨åŸŸé—®é¢˜ã€‚

### â‘  å‰ç«¯

- åŸç”Ÿ js æ–¹å¼

```html
<body>
  <script>
    var scriptTag = document.createElement('script')
    // å¯ä»¥è‡ªå®šä¹‰callbackå‡½æ•°çš„å‡½æ•°å
    scriptTag.src = 'http://127.0.0.1:3000/api/list?callback=listBack'
    document.body.appendChild(scriptTag)

    function listBack(obj) {
      console.log(obj)
    }
  </script>
</body>
```

- jQuery æ–¹å¼

```html
<body>
  <script src="./lib/jquery.min.js"></script>
  <script>
    $(function () {
      $.ajax({
        dataType: 'jsonp',
        url: 'http://127.0.0.1:3000/api/list',
        // å¯ä»¥è‡ªå®šä¹‰ğŸš©callbackå‡½æ•°çš„å‡½æ•°å
        jsonp: 'callback',
        jsonpCallback: 'listBack',

        // æºå¸¦çš„å‚æ•°
        data: {},

        success: function (res) {
          console.log(res)
        }
      })
    })
  </script>
</body>
```

### â‘¡ åç«¯

- Node.js æ–¹å¼

```js
const http = require('http')
const url = require('url')

// åˆ›å»ºwebæœåŠ¡å™¨
http
  .createServer((req, res) => {
    // è·å–å‰ç«¯å®šä¹‰çš„callbackåç§°
    const urlobj = url.parse(req.url, true)

    callbackName = urlobj.query.callback
    // æ ¹æ®å‰ç«¯çš„éœ€æ±‚ç¼–å†™æ¥å£
    switch (urlobj.pathname) {
      case '/api/list':
        // ä½¿ç”¨åŠ¨æ€è¿”å›ğŸš©çš„å‡½æ•°å
        res.end(
          `${callbackName}(${JSON.stringify({
            name: 'phone',
            price: 4999
          })})`
        )
        break
      default:
        res.end('404')
        break
    }
  })
  .listen(3000, '127.0.0.1', () => {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

## äºŒã€CORS æ–¹å¼ï¼ˆåç«¯è§£å†³ï¼‰

### â‘  å‰ç«¯

&emsp;&emsp;ç”±äºé€šè¿‡ CORS çš„æ–¹å¼ï¼Œåç«¯å·²ç»è§£å†³äº†è·¨åŸŸé—®é¢˜ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥ä¸ç”¨é€šè¿‡\<script>æ ‡ç­¾çš„ src å±æ€§æ¥è°ƒç”¨æ¥å£ã€‚

> æ­¤æ—¶ç›´æ¥ä½¿ç”¨ ajax çš„æ–¹å¼å°±å¯ä»¥è°ƒç”¨æ¥å£æ•°æ®äº†ï¼Œä¸‹é¢å°±ä½¿ç”¨å¸¸ç”¨çš„ axios æ¥è¯·æ±‚æ•°æ®å§ã€‚

- fetch æ–¹å¼

```html
<body>
  <script>
    fetch('http://127.0.0.1:3000/api/list?id=1')
      // jsonæ ¼å¼åŒ–
      .then((res) => res.json())
      .then((res) => {
        //è¾“å‡ºå“åº”æ•°æ®
        console.log(res)
      })
  </script>
</body>
```

- axios æ–¹å¼

```html
<body>
  <script src="./lib/axios.min.js"></script>
  <script>
    async function axios_get() {
      const { data: res } = await axios({
        method: 'GET',
        url: 'http://127.0.0.1:3000/api/list',
        //getè¯·æ±‚urlä¸­çš„æŸ¥è¯¢å‚æ•° â€”â€” âœ¨params
        params: { id: 1 }
      })
      console.log(res)
    }

    axios_get()
  </script>
</body>
```

### â‘¡ åç«¯

- Node.js

```js
const http = require('http')
const url = require('url')

// åˆ›å»ºwebæœåŠ¡å™¨
http
  .createServer((req, res) => {
    // è·å–å‰ç«¯å®šä¹‰çš„callbackåç§°
    const urlobj = url.parse(req.url, true)

    callbackName = urlobj.query.callback

    res.writeHead(200, {
      'content-type': 'application',
      // è·¨åŸŸé—®é¢˜è§£å†³æ–¹æ¡ˆï¼šCORSğŸš©å¤´
      'Access-Control-Allow-Origin': '*'
    })

    // æ ¹æ®å‰ç«¯çš„éœ€æ±‚ç¼–å†™æ¥å£
    switch (urlobj.pathname) {
      case '/api/list':
        // ç›´æ¥âœ¨è¿”å›JSONæ•°æ®
        res.end(
          `(${JSON.stringify({
            name: 'phone',
            price: 4999
          })})`
        )
        break
      default:
        res.end('404')
        break
    }
    res.end()
  })
  .listen(3000, '127.0.0.1', () => {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

## ä¸‰ã€express è·¨åŸŸ ä¸ cors

1ã€å®‰è£… cors ä¸­é—´ä»¶

> npm i cors -S

2ã€ä½¿ç”¨ [cors ä¸­é—´ä»¶](https://github.com/expressjs/cors)

- æ‰€æœ‰è·¨åŸŸè¯·æ±‚

```js
const cors = require('cors')
app.use(cors())
```

- å•ä¸ªè·¯ç”±è¯·æ±‚

```js
var express = require('express')
var cors = require('cors')
var app = express()

app.get('/products/:id', cors(), function (req, res, next) {
  res.json({ msg: 'This is CORS-enabled for a Single Route' })
})

app.listen(80, function () {
  console.log('CORS-enabled web server listening on port 80')
})
```

3ã€è·¨åŸŸè¯·æ±‚é…ç½®

```js
var express = require('express')
var cors = require('cors')
var app = express()

var corsOptions = {
  origin: 'http://example.com',
  optionsSuccessStatus: 200 // some legacy browsers (IE11, various SmartTVs) choke on 204
}

app.get('/products/:id', cors(corsOptions), function (req, res, next) {
  res.json({ msg: 'This is CORS-enabled for only example.com.' })
})

app.listen(80, function () {
  console.log('CORS-enabled web server listening on port 80')
})
```

## å››ã€vue-cli å¼€å‘ç¯å¢ƒè·¨åŸŸè¯·æ±‚

### 1ã€å®˜æ–¹è§£é‡Šï¼š

&emsp;&emsp;å¦‚æœä½ çš„å‰ç«¯åº”ç”¨å’Œåç«¯ API æœåŠ¡å™¨æ²¡æœ‰è¿è¡Œåœ¨åŒä¸€ä¸ªä¸»æœºä¸Šï¼Œä½ éœ€è¦åœ¨ <span style="background-color:yellow;color:black">å¼€å‘ç¯å¢ƒä¸‹</span> å°† API è¯·æ±‚ä»£ç†åˆ° API æœåŠ¡å™¨ã€‚

&emsp;&emsp;è¿™ä¸ªé—®é¢˜å¯ä»¥é€šè¿‡ `vue.config.js` ä¸­çš„ <span style="color:red">devServer.proxy</span> é€‰é¡¹æ¥é…ç½®ã€‚

### 2ã€æœ¬è´¨

é€šè¿‡å®˜æ–¹å¯ä»¥å‘ç°ï¼Œå®ƒæ˜¯ä½¿ç”¨äº†[http-proxy-middleware ä¸­é—´ä»¶](https://github.com/chimurai/http-proxy-middleware#proxycontext-config)

- å®‰è£…

```sh
npm install --save-dev http-proxy-middleware
```

- ä½¿ç”¨

```js
const express = require('express')
const { createProxyMiddleware } = require('http-proxy-middleware')

const app = express()

app.use(
  '/api',
  createProxyMiddleware({
    target: 'http://www.example.org/secret',
    changeOrigin: true
  })
)

app.listen(3000)

// proxy and change the base path from "/api" to "/secret"
// http://127.0.0.1:3000/api/foo/bar -> http://www.example.org/secret/foo/bar

//æ€»ç»“ï¼šè¯·æ±‚åœ°å€æœ‰/apiçš„æ—¶å€™ï¼Œå°±è§¦å‘ä»£ç†æœºåˆ¶
```

### 3ã€vue-cli ä¸­ä½¿ç”¨

â‘  å°†ä»»ä½•æœªçŸ¥è¯·æ±‚ (æ²¡æœ‰åŒ¹é…åˆ°é™æ€æ–‡ä»¶çš„è¯·æ±‚) ä»£ç†åˆ° http://localhost:4000

```js
module.exports = {
  devServer: {
    proxy: 'http://localhost:4000'
  }
}
```

â‘¡ å¯¹æŒ‡å®šè¯·æ±‚è¿›è¡Œä»£ç†

```js
module.exports = {
  devServer: {
    // ä¸€ã€æœ¬æœºåœ°å€
    open: true,
    host: 'localhost',
    port: 8080, // é»˜è®¤ä¸º8080
    https: false,
    // äºŒã€å¾…è·¨åŸŸåœ°å€
    proxy: {
      // è¯·æ±‚åœ°å€æœ‰/devçš„æ—¶å€™,å°±å‡ºè§¦å‘ä»£ç†æœºåˆ¶
      //ï¼ˆè¿™é‡Œä»…ä»…ä½œä¸ºè·¨åŸŸè¯·æ±‚çš„æ ‡å¿—ï¼Œåé¢ä½¿ç”¨åœ¨è·¨åŸŸè¯·æ±‚è·¯å¾„æ—¶ä¸­è¦æºå¸¦ä»¥/devå¼€å¤´ï¼‰
      '/dev': {
        target: '<url>', //è¦ä»£ç†çš„åŸŸååœ°å€
        ws: true, // å¼€å¯webSocket
        changeOrigin: true, // å¼€å¯ä»£ç†
        pathRewrite: {
          '^/dev': '' // åœ¨å®é™…è¯·æ±‚æ—¶å»é™¤/devè·¯å¾„
        }
      },
      '/foo': {
        target: '<other_url>'
      }
    }
  }
}
```

### 4ã€ç”Ÿäº§ç¯å¢ƒè·¨åŸŸ

&emsp;&emsp;ç”Ÿäº§ç¯å¢ƒè¡¨ç¤ºæˆ‘ä»¬å·²ç»å¼€å‘å®Œæˆé¡¹ç›®ï¼Œå°†é¡¹ç›®éƒ¨ç½²åˆ°äº†æœåŠ¡å™¨ä¸Š,è¿™æ—¶å·²ç»æ²¡æœ‰äº† vue-cli è„šæ‰‹æ¶çš„è¾…åŠ©äº†ã€‚

&emsp;&emsp;æˆ‘ä»¬åªæ˜¯æŠŠæ‰“åŒ…å¥½çš„ html+js+css äº¤ä»˜è¿ç»´äººå‘˜ï¼Œæ”¾åˆ° Nginx æœåŠ¡å™¨è€Œå·²,æ‰€ä»¥æ­¤æ—¶éœ€è¦å€ŸåŠ© Nginx çš„åå‘ä»£ç†æ¥è¿›è¡Œã€‚

## äº”ã€Nginx åå‘ä»£ç†

å—ç›Šäºè§†é¢‘ï¼š

> https://www.bilibili.com/video/BV1uK411p7Bp/

### 1ã€å‰ç«¯é¡¹ç›®éƒ¨ç½²æ—¶

é…ç½®

- nginx / conf / nginx.conf

```ini
# é»˜è®¤ï¼šuser  nobody;
user www
http {
  server{
    # ç›‘å¬80ç«¯å£
    listen 80;
    # æœåŠ¡å™¨åœ°å€ï¼ˆæœ¬æœºï¼‰æˆ–ç»‘å®šåŸŸå
    server_name localhost;

    # ä¸€ã€å‰ç«¯ğŸš©ä»£ç†
    location / {
      # é»˜è®¤ï¼š
      # root   html;
      # index  index.html index.htm;
      root <å‰ç«¯é¡¹ç›®è·¯å¾„ï¼ˆä¾‹å¦‚ï¼š/www/wwwroot/ruoyi-ui/distï¼‰>;
      index  index.html index.htm;
    }
  }
}
```

å¯åŠ¨

```sh
cd nginx/sbin/nginx
```

### 2ã€åå‘ä»£ç†åç«¯é¡¹ç›®è¯·æ±‚åœ°å€

- nginx / conf / nginx.conf

```ini
server{
  # ç›‘å¬80ç«¯å£
  listen 80;
  # æœåŠ¡å™¨åœ°å€ï¼ˆæœ¬æœºï¼‰æˆ–ç»‘å®šåŸŸå
  server_name localhost;

  #å‡¡æ˜¯<æœåŠ¡å™¨åœ°å€>:80/devè¿™ä¸ªæ ·å­çš„ï¼Œéƒ½è½¬å‘åˆ°çœŸæ­£çš„æœåŠ¡ç«¯åœ°å€<proxy-url>

  # äºŒã€åç«¯ğŸš©ä»£ç†
  location ^~ /dev {
    # é…ç½®åå‘ä»£ç†çš„ipåœ°å€å’Œç«¯å£å· ã€æ³¨ï¼šè¿™é‡Œçš„urlåœ°å€éœ€åŠ ä¸Šhttp:// æˆ– https://ã€‘
    proxy_pass <proxy-url>;
  }
}
```

&emsp;&emsp;è‹¥ç»‘å®šçš„åŸŸåä¸ºè¦æ‰€ä»¥`https`åè®®ï¼Œè¿˜éœ€è¦æ·»åŠ  SSL é…ç½®ã€‚

```ini
server{
  # ç›‘å¬80ç«¯å£
  listen 80 ssl;

  # æ·»åŠ SSLè¯ä¹¦æ–‡ä»¶
  ssl_certificate <æ–‡ä»¶åœ°å€>
  ssl_certificate_key <æ–‡ä»¶åœ°å€>

  # æœåŠ¡å™¨åœ°å€ï¼ˆæœ¬æœºï¼‰æˆ–ç»‘å®šåŸŸå
  server_name <ç»‘å®šçš„åŸŸå>;
}
```

### æ‹“å±•

&emsp;è¿è¡Œç¯å¢ƒé…ç½® mysqlã€nginxã€Tomcatã€Redis ç­‰ç­‰

æŠ€æœ¯ï¼š

- [Docker](https://www.bilibili.com/video/BV1CJ411T7BK)
- Docker + K8s
