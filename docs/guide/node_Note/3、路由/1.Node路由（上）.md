## è·¯ç”±

&emsp;&emsp;å…³äºŽä»€ä¹ˆæ˜¯è·¯ç”±ï¼Œæˆ‘å°±ä¸è¿‡å¤šçš„ä»‹ç»äº†ï¼Œåœ¨å­¦ä¹  vue çš„æ—¶å€™æœ‰åšè¿‡è¯¦ç»†çš„ç¬”è®°ã€‚

## ä¸€ã€è·¯ç”±ç¤ºä¾‹

æ€è€ƒæ‰“å°ç»“æžœï¼š

```js
http
  .createServer((req, res) => {
    console.log(req.url)
    res.end()
  })
  .listen(3000, '127.0.0.1', function () {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

### 1ã€ç®€å•è·¯ç”±

- server.js

```js
const http = require('http')
const fs = require('fs')

http
  .createServer((req, res) => {
    const myURL = new URL(req.url, 'http://127.0.0.1')
    switch (myURL.pathname) {
      case '/home':
        res.writeHead(200, { 'Content-Type': 'text/html;charset=utf8' })
        res.write(fs.readFileSync('./static/home.html'), 'utf-8')
        break
      case '/login':
        res.writeHead(200, { 'Content-Type': 'text/html;charset=utf8' })
        res.write(fs.readFileSync('./static/login.html'), 'utf-8')
        break
      default:
        res.writeHead(404, { 'Content-Type': 'text/html;charset=utf8' })
        res.write(fs.readFileSync('./static/404.html'), 'utf-8')
    }
    res.end()
  })
  .listen(3000, '127.0.0.1', function () {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

### 2ã€å‡çº§ï¼ˆé™ä½Žè€¦åˆåº¦ï¼‰

- server.js

```js
const http = require('http')
const route = require('./route')

http
  .createServer((req, res) => {
    const myURL = new URL(req.url, 'http://127.0.0.1')

    route(req, res, myURL.pathname)
    res.end()
  })
  .listen(3000, '127.0.0.1', function () {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

- route.js

```js
const fs = require('fs')

function route(req, res, pathname) {
  switch (pathname) {
    case '/home':
      res.writeHead(200, { 'Content-Type': 'text/html;charset=utf8' })
      res.write(fs.readFileSync('./static/home.html'), 'utf-8')
      break
    case '/login':
      res.writeHead(200, { 'Content-Type': 'text/html;charset=utf8' })
      res.write(fs.readFileSync('./static/login.html'), 'utf-8')
      break
    default:
      res.writeHead(404, { 'Content-Type': 'text/html;charset=utf8' })
      res.write(fs.readFileSync('./static/404.html'), 'utf-8')
  }
}

module.exports = route
```

### 3ã€å‡çº§ï¼ˆswitch æ–¹å¼ æ”¹ä¸º å¯¹è±¡æ–¹å¼ï¼‰

- server.js

```js
const http = require('http')
const route = require('./route')

http
  .createServer((req, res) => {
    const myURL = new URL(req.url, 'http://127.0.0.1')

    // 1ã€ç»†èŠ‚ä¸€
    // ä½¿ç”¨try...catchè¾¾åˆ°ç±»ä¼¼switchä¸­defaultðŸš©çš„æ•ˆæžœ
    try {
      route[myURL.pathname](req, res)
    } catch (error) {
      route['/404'](req, res)
    }
    res.end()
  })
  .listen(3000, '127.0.0.1', function () {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

- route.js

```js
const fs = require('fs')

const route = {
  '/home': (req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/html;charset=utf8' })
    res.write(fs.readFileSync('./static/home.html'), 'utf-8')
  },
  '/login': (req, res) => {
    res.writeHead(200, { 'Content-Type': 'text/html;charset=utf8' })
    res.write(fs.readFileSync('./static/login.html'), 'utf-8')
  },
  '/404': (req, res) => {
    res.writeHead(404, { 'Content-Type': 'text/html;charset=utf8' })
    res.write(fs.readFileSync('./static/404.html'), 'utf-8')
  },
  // è§£å†³å›¾æ ‡è¯·æ±‚
  '/favicon.ico': (req, res) => {
    // 2ã€ç»†èŠ‚äºŒâœ¨
    res.writeHead(200, { 'Content-Type': 'image/x-icon;charset=utf8' })
    res.write(fs.readFileSync('./static/favicon.ico'))
  }
}

module.exports = route
```

> åœ¨æµè§ˆå™¨ä¸ŠæŒ‰`Ctrl + F5`å¼ºåˆ¶åˆ·æ–°ï¼Œæ‰ä¼šæ˜¾ç¤ºå›¾æ ‡ã€‚

### 4ã€å‡çº§ï¼ˆäºŒæ¬¡è§£è€¦ã€å°è£…æ€æƒ³ï¼‰

- server.js

```js
const http = require('http')
const route = require('./route')

http
  .createServer((req, res) => {
    const myURL = new URL(req.url, 'http://127.0.0.1')

    try {
      route[myURL.pathname](req, res)
    } catch (error) {
      route['/404'](req, res)
    }
  })
  .listen(3000, '127.0.0.1', function () {
    console.log('Server running at http://127.0.0.1:3000')
  })
```

- route.js

```js
const fs = require('fs')

function render(res, path, type = '') {
  res.writeHead(200, {
    'Content-Type': `${type ? type : 'text/html'};charset=utf8`
  })
  res.write(fs.readFileSync(path), 'utf-8')
  res.end()
}

const route = {
  '/home': (req, res) => {
    render(res, './static/login.html')
  },
  '/login': (req, res) => {
    render(res, './static/login.html')
  },
  '/404': (req, res) => {
    res.writeHead(404, {
      'Content-Type': 'text/html;charset=utf8'
    })
    res.write(fs.readFileSync('./static/404.html'), 'utf-8')
    res.end()
  },
  '/favicon.ico': (res) => {
    render(req, res, './static/favicon.ico', 'image/x-icon')
  }
}

module.exports = route
```

### 5ã€å‡çº§ï¼ˆå°è£…æ€æƒ³ï¼‰

- index.jsï¼ˆå¯åŠ¨å…¥å£ï¼‰

```js
const server = require('./server')

server.start()
```

- server.js

```js
const http = require('http')
const route = require('./route')

function start() {
  http
    .createServer((req, res) => {
      const myURL = new URL(req.url, 'http://127.0.0.1')

      try {
        route[myURL.pathname](req, res)
      } catch (error) {
        route['/404'](req, res)
      }
    })
    .listen(3000, '127.0.0.1', function () {
      console.log('Server running at http://127.0.0.1:3000')
    })
}

exports.start = start
```

## äºŒã€api æŽ¥å£è·¯ç”±ç¤ºä¾‹

&emsp;&emsp;ä¸ºäº†é™ä½Žè€¦åˆåº¦ï¼Œä¸‹é¢ api éƒ¨åˆ†çš„ä»£ç ä¸ä¼šå†™åˆ° route.js ä¸­ï¼Œä¼šå•ç‹¬æŠ½ç¦»å‡ºæ¥ api.jsã€‚

> æ™®é€šè·¯ç”±ï¼štext/html + static æ–‡ä»¶
> api è·¯ç”±ï¼šapplication/json + data æ•°æ®

### 1ã€api æŽ¥å£

- api.js

```js
const fs = require('fs')

function render(res, data, type = '') {
  res.writeHead(200, {
    'Content-Type': `${type ? type : 'application/json'};charset=utf8`
  })
  res.write(data)
  res.end()
}

const apiRoute = {
  '/api/login': (req, res) => {
    render(res, `{"ok":1}`)
  }
}

module.exports = apiRoute
```

### 2ã€åˆå¹¶è·¯ç”±

> ä½¿ç”¨ ES6 è¯­æ³•ï¼ˆæµ…æ‹·è´ï¼‰å®žçŽ°

- server.js

```js
const http = require('http')

const route = require('./route')
const apiRoute = require('./apiRoute')

// å®žçŽ°è·¯ç”±åˆå¹¶
const Router = {}
Object.assign(Router, route)
Object.assign(Router, apiRoute)

function start() {
  http
    .createServer((req, res) => {
      const myURL = new URL(req.url, 'http://127.0.0.1')

      try {
        Router[myURL.pathname](req, res)
      } catch (error) {
        Router['/404'](req, res)
      }
    })
    .listen(3000, '127.0.0.1', function () {
      console.log('Server running at http://127.0.0.1:3000')
    })
}

exports.start = start
```

### 3ã€å‡çº§ï¼ˆé™ä½Žè€¦åˆåº¦ï¼‰

- index.js

```js
const server = require('./server')

const route = require('./route')
const api = require('./api')

// æå‰æ³¨å†Œï¼ˆåˆå¹¶ï¼‰è·¯ç”±
server.use(route)
server.use(api)

server.start()
```

- server.js

```js
const http = require('http')

const Router = {}

function use(obj) {
  Object.assign(Router, obj)
}

function start() {
  http
    .createServer((req, res) => {
      const myURL = new URL(req.url, 'http://127.0.0.1')

      try {
        Router[myURL.pathname](req, res)
      } catch (error) {
        Router['/404'](req, res)
      }
    })
    .listen(3000, '127.0.0.1', function () {
      console.log('Server running at http://127.0.0.1:3000')
    })
}

exports.start = start
exports.use = use
```
