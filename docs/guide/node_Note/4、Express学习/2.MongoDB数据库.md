## æ•°æ®åº“

åˆ†ç±»ï¼š

- å…³ç³»å‹æ•°æ®åº“ï¼šmysqlã€SqlServerã€db2ã€oracle
- éå…³ç³»å‹æ•°æ®åº“ï¼šMongoDBã€Redis

## ä¸€ã€MongoDB åŸºç¡€

&emsp;&emsp;ä¸ªäººæ¨èä½¿ç”¨[ç»¿è‰²å…å®‰è£…ç‰ˆ](https://www.mongodb.com/try/download/community)ï¼ˆé»˜è®¤ç«¯å£å·ï¼š27017ï¼‰ã€‚å…³äºç¯å¢ƒå˜é‡å°±æš‚æ—¶ä¸ç”¨é…ç½®äº†ï¼Œç›´æ¥åœ¨ MongoDB æ•°æ®åº“çš„ bin ç›®å½•æ‰“å¼€ç»ˆç«¯æ“ä½œå³å¯ã€‚

â‘  å¯åŠ¨æœåŠ¡ç«¯ï¼ˆmongod.exeï¼‰ï¼š

å‡†å¤‡å·¥ä½œï¼š

- åœ¨ä»»æ„ç›®å½•ä¸‹åˆ›å»º data æ–‡ä»¶å¤¹ï¼Œå†…å«ä¸¤ä¸ªæ–‡ä»¶å¤¹ db å’Œ log ï¼Œå…¶ä¸­ log æ–‡ä»¶åˆ›å»ºä¸€ä¸ª mongodb.log æ–‡ä»¶

- æ ¹ç›®å½•æ–°å»º mongod.conf

```ini
dbpath = D:\install_pack\mongodb\data\db
logpath = D:\install_pack\mongodb\data\log\mongodb.log
logappend = true
port = 27017
```

æ­£å¼å¯åŠ¨ï¼š

```sh
.\mongod.exe --config=D:\install_pack\mongodb\mongod.conf

.\mongod.exe
```

â‘¡ å¯åŠ¨å®¢æˆ·ç«¯ï¼ˆmongo.exeï¼‰ï¼š

```sh
.\mongo.exe ï¼ˆé»˜è®¤ç›´æ¥è¿æ¥ï¼Œæ— éœ€èº«ä»½éªŒè¯ï¼‰
```

â‘¢ å¯è§†åŒ–å®¢æˆ·ç«¯

- Robo 3T (Robomong)

### 1ã€æ•°æ®åº“ã€èšé›†é›†åˆæ“ä½œ

```sh
å±•ç¤ºæ‰€æœ‰æ•°æ®åº“
show dbs
å±•ç¤ºå½“å‰æ•°æ®åº“
db

åˆ›å»º/åˆ‡æ¢æ•°æ®åº“
use <æ•°æ®åº“å>
åˆ é™¤æ•°æ®åº“
db.dropDatabase()
```

```sh
å±•ç¤ºæ‰€æœ‰é›†åˆ
db.getCollectionNames()

åˆ›å»ºé›†åˆ
db.createCollection('<é›†åˆå>')
åˆ é™¤é›†åˆ
db.<é›†åˆå>.drop()
```

### 2ã€æ•°æ®çš„å¢ã€åˆ ã€æ”¹

```sh
æŸ¥è¯¢å½“å‰ğŸš©é›†åˆçš„æ‰€æœ‰è®°å½•
db.<é›†åˆå>.find()
```

```sh
å¢
db.<é›†åˆå>.save([{username:'zhangsan',password:123},{username:'lisi',password:456}])

åˆ é™¤æŒ‡å®šè®°å½•
db.<é›†åˆå>.remove({username:'lisi'})
åˆ é™¤æ‰€æœ‰è®°å½•
db.<é›†åˆå>.remove({})

æ”¹
db.<é›†åˆå>.update({username:'lisi'},{username:'lisi_pro',password:888})
db.<é›†åˆå>.update({username:'lisi'},{$set:{password:666}})
```

### 3ã€æ•°æ®çš„æŸ¥

```sh
æŸ¥è¯¢å½“å‰ğŸš©é›†åˆçš„æ‰€æœ‰è®°å½•
db.<é›†åˆå>.find()
```

```sh
1ã€æŒ‡å®šèŒƒå›´
db.<é›†åˆå>.find({ag:22 })
db.<é›†åˆå>.find({age:{$gt:22} })
db.<é›†åˆå>.find({age:{$gte:22} })  >=
db.<é›†åˆå>.find({age:{$lt:22} })
db.<é›†åˆå>.find({age:{$lte:22} })  <=

db.<é›†åˆå>.find({age:{$gt:22, $lt:35} })

2ã€æŒ‡å®šå†…å®¹
# and
db.<é›†åˆå>.find({username:'lencamo', age:23})
# or
db.<é›†åˆå>.find($or:[{username:'lencamo', age:23}])

3ã€å…¶ä»–
db.<é›†åˆå>.find().limit(5)
db.<é›†åˆå>.find().skip(5)

db.<é›†åˆå>.find().count()
```

## äºŒã€MongoDB ä¸ Node.js

### 1ã€å®‰è£…

```sh
npm i mongoose
```

### 2ã€è¿æ¥æ•°æ®åº“

- bin/www

```js
require('../config/db.config.js')
```

- æ–°å»ºï¼šconfig/db.config.js

```js
const mongoose = require('mongoose')

mongoose.connect('mongodb://127.0.0.1:27017/ren_db')
```

### 3ã€åˆ›å»ºé›†åˆå¯¹åº”çš„ MongoDB æ¨¡å‹

- æ–°å»ºï¼šmodel/userModel.js

```js
const mongoose = require('mongoose')

const Schema = mongoose.Schema
const UserType = {
  username: String,
  password: String,
  age: Number
  phone: String,
}

// åˆ›å»ºçš„useræ¨¡å‹ï¼Œä¼šè‡ªåŠ¨å¯¹åº”usersé›†åˆ
const userModel = mongoose.model('user', new Schema(UserType))

module.exports = UserModel
```

### 4ã€API æ¥å£

- app.js

```js
const usersRouter = require('./router/usersRouter')

app.use('/api', usersRouter)
```

- router/usersRouter.js

```js
// å¯¼å…¥useræ¨¡å‹ï¼ˆè¿™æ ·å°±å¯ä»¥ğŸš©ä½¿ç”¨user.create | user.find | user.delete | user.updateæ¥æ“ä½œæ•°æ®äº†ï¼‰
const UserModel = require('../model/UserModel')

router.post('/user/add', (req, res) => {
  console.log(req.body)

  // ç›´æ¥æ“ä½œæ•°æ®åº“  âœ–ï¼ˆå¤æ‚ï¼‰
  // db.users.ã€â€¦â€¦ã€‘

  // é€šè¿‡useræ¨¡å‹ âœ”
})
```

â‘  å¢

```js
router.post('/user/add', (req, res) => {
  console.log(req.body)
  // âœ¨å‰ç«¯ä¼ æ¥çš„æ•°æ®
  const { username, password, age, phone } = req.body

  UserModel.create({
    username,
    password,
    age,
    phone
  }).then((data) => {
    console.log(data)

    res.send({
      ok: 1
    })
  })
})
```

â‘¡ åˆ 

```js
router.get('/user/delectable/:id', (req, res) => {
  console.log(req.body)
  // âœ¨å‰ç«¯ä¼ æ¥çš„æ•°æ®
  const { username, password, age, phone } = req.body
  // âœ¨å‰ç«¯ä¼ æ¥çš„åŠ¨æ€idå€¼
  const _id = req.params.id

  UserModel.deleteOne({ _id }).then((data) => {
    console.log(data)

    res.send({
      ok: 1
    })
  })
})
```

â‘¢ æ”¹

```js
router.post('/user/update/:id', (req, res) => {
  console.log(req.body)
  // âœ¨å‰ç«¯ä¼ æ¥çš„æ•°æ®
  const { username, password, age, phone } = req.body
  // âœ¨å‰ç«¯ä¼ æ¥çš„åŠ¨æ€idå€¼
  const _id = req.params.id

  UserModel.updateOne(
    { _id },
    {
      username,
      password,
      age,
      phone
    }
  ).then((data) => {
    console.log(data)

    res.send({
      ok: 1
    })
  })
})
```

â‘£ æŸ¥

```js
router.post('/user/list', (req, res) => {
  console.log(req.body)

  // æŒ‰ç…§ageæ­£åºæ’åˆ—ã€å¹¶ä¸”åªè¿”å›ç”¨æˆ·åå’Œç”µè¯å·ç æ•°æ®
  UserModel.find({}, ['username', 'phone'])
    .sort({ age: 1 })
    .then((data) => {
      console.log(data)

      res.send({
        ok: 1
      })
    })
})
```

```js
router.post('/user/list', (req, res) => {
  console.log(req.body)

  // è·å–è¯·æ±‚ğŸš©å‚æ•°
  console.log(req.query)
  const { page, limit } = req.query

  // æŒ‰ç…§ageæ­£åºæ’åˆ—ã€å¹¶ä¸”åªè¿”å›ç”¨æˆ·åå’Œç”µè¯å·ç æ•°æ®
  UserModel.find({}, ['username', 'phone'])
    .sort({ age: 1 })
    .skip((page - 1) * limit)
    .limit(limit)
    .then((data) => {
      console.log(data)

      res.send({
        ok: 1
      })
    })
})
```

### 5ã€å®ä¾‹é¡µé¢ã€æ¥å£è°ƒç”¨

- index.ejs

```html
<body>
  <div>
    <div>ç”¨æˆ·åï¼š<input id="username" /></div>
    <div>å¯†ç ï¼š<input type="password" id="password" /></div>
    <div>å¹´é¾„ï¼š<input type="number" id="age" /></div>
    <div>æ‰‹æœºå·ï¼š<input id="phone" /></div>
  </div>
  <div>
    <button id="register">æ³¨å†Œ</button>
    <button id="delectable">åˆ é™¤</button>
    <button id="update">æ›´æ–°</button>
    <button id="checkup">æŸ¥è¯¢</button>
  </div>

  <br />

  <tbody>
    <thead>
      <tr>
        <td>idå€¼</td>
        <td>ç”¨æˆ·å</td>
        <td>æ‰‹æœºå·</td>
      </tr>
      <!-- æ•°æ®åŒºåŸŸ -->
    </thead>
  </tbody>
</body>
```

â‘  å¢

```html
<script>
  // 1ã€æ³¨å†Œï¼ˆå¢ï¼‰
  register.onclick = () => {
    fetch('api/user/add', {
      method: 'POST',
      body: JSON.stringify({
        username: username.value,
        password: password.value,
        age: age.value,
        phone: phone.value
      }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
      .then((res) => res.json())
      .then((res) => {
        console.log(res)
      })
  }
</script>
```

â‘¡ åˆ 

```html
<script>
  // 1ã€æ³¨å†Œï¼ˆå¢ï¼‰
  delectable.onclick = () => {
    fetch('api/user/delectable/4563456345632345fad1')
      .then((res) => res.json())
      .then((res) => {
        console.log(res)
      })
  }
</script>
```

â‘¢ æ”¹

```html
<script>
  update.onclick = () => {
    fetch('api/user/update/4563456345632345fad1', {
      method: 'POST',
      body: JSON.stringify({
        username: 'lencamo',
        password: '123456',
        age: 21,
        phone: 13653688245
      }),
      headers: {
        'Content-Type': 'application/json'
      }
    })
      .then((res) => res.json())
      .then((res) => {
        console.log(res)
      })
  }
</script>
```

â‘£ æŸ¥

```html
<script>
  // è·å–æ•°æ®ï¼ˆæŸ¥ï¼‰
  checkup.onclick = () => {
    // 1ã€æ‰€æœ‰æ•°æ®
    fetch('api/user/list')
      .then((res) => res.json())
      .then((res) => {
        console.log(res)
        var tbody = document.querySelector('tbody')

        // map æ˜ å°„
        tbody.innerHTML = res
          .map(
            (item) => `
          <tr>
            <td>${item._id}</td>
            <td>${item.username}</td>
            <td>${item.phone}</td>
          </tr>
        `
          )
          .join('')
      })
</script>
```

```html
<script>
  // è·å–æ•°æ®ï¼ˆæŸ¥ï¼‰
  checkup.onclick = () => {
    // 2ã€æ¡ä»¶æ•°æ®
    fetch('api/user/list?page=1&limit=10')
      .then((res) => res.json())
      .then((res) => {
        console.log(res)
      })
  }
</script>
```
