## ç»„ä»¶é—´çš„å…³ç³»

&emsp;&emsp;åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œç»„ä»¶ä¹‹é—´çš„æœ€å¸¸è§çš„å…³ç³»æœ‰å¦‚ä¸‹ä¸¤ç§ï¼š

- â‘  çˆ¶å­å…³ç³»
- â‘¡ å…„å¼Ÿå…³ç³»

## ä¸€ã€ç»„ä»¶é—´çš„æ•°æ®å…±äº«

### 1ã€çˆ¶å‘å­ä¼ æ•°æ®

æ€è€ƒï¼Ÿ

> å‰é¢æˆ‘ä»¬å­¦çš„ <span style="background-color: yellow;color:black;">props å±æ€§</span> å®ç° <span style="color:red;">è‡ªå®šä¹‰å±æ€§</span>ï¼š`:å±æ€§å`ã€‚âœ¨

&emsp;&emsp;è¦æ³¨æ„çš„æ˜¯ï¼Œç»„ä»¶ä¸­å°è£…çš„è‡ªå®šä¹‰å±æ€§æ˜¯ <span style="background-color: yellow;color: black">åªè¯»çš„</span> ï¼Œç¨‹åºå‘˜<span style="color: green;">ä¸èƒ½ç›´æ¥ä¿®æ”¹</span>ã€‚

ç¤ºä¾‹ï¼š

- Ren.vueï¼ˆçˆ¶ï¼‰

```html
<template>
  <div>
    <!-- å‘å­ç»„ä»¶âœ¨ä¼ å…¥æ•°æ® -->
    <Son :msg="message" :user="userInfo"></Son>
  <div>
</template>

<script>
  import Son from "@/components/Son.vue";

  export default {
    data() {
      return {
        message: 'ä¸ªäººä¿¡æ¯ï¼ˆfatherï¼‰',
        userInfo: {
          name: 'lencamo',
          age: 20,
        }
      };
    },
    components: {
      Son,
    }
  };
</script>
```

- Son.vueï¼ˆå­ï¼‰

```html
<template>
  <div>
    <p>{{ msg }}</p>
    <p>{{ user.name }} {{ user.age}}</p>
  <div>
</template>

<script>
  export default {
    props: ['msg', 'user'],
  };
</script>
```

### 2ã€å­å‘çˆ¶ä¼ æ•°æ®

&emsp;&emsp;ä¸çˆ¶å‘å­ä¼ æ•°æ®ä¸åŒçš„æ˜¯ï¼šå­ç»„ä»¶å‘çˆ¶ç»„ä»¶å…±äº«æ•°æ®ä½¿ç”¨ <span style="background-color: yellow;color:black;">$emit()</span> æ¥ <span style="color:red;">è‡ªå®šä¹‰äº‹ä»¶</span>ï¼š`@äº‹ä»¶å`ã€‚âœ¨

&emsp;&emsp;è€Œå­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ é€’çš„æ•°æ®é€šå¸¸æ˜¯ å‚æ•° çš„å½¢å¼ã€‚ä¾‹å¦‚ä¸‹é¢çš„å°†å­ç»„ä»¶çš„æœ€æ–°æ•°æ®ä¸çˆ¶ç»„ä»¶çš„åŒæ­¥æ¡ˆä¾‹ï¼š

- Son.vueï¼ˆå­ï¼‰

```html
<template>
  <div>
    <!-- ä¼ é€’countæ•°æ®å€¼ -->
    <!-- é€šè¿‡ $emit() ğŸš© è§¦å‘è‡ªå®šä¹‰äº‹ä»¶ -->
    <button @click="$emit('msgPost', this.count)">ç»™çˆ¶ç»„ä»¶ä¼ å€¼</button>
  <div>
</template>

<script>
  export default {
    data() {
      return {
        msg: 'lencamo',
      };
    },
  };
</script>
```

- Ren.vueï¼ˆçˆ¶ï¼‰

```html
<template>
  <div>
    <!--æ¥æ”¶å­ç»„ä»¶ä¼ å…¥æ•°æ® -->
    <Son @msgPost="getMsgFn"></Son>

    <p>{{ sonMsg }}</p>
  <div>
</template>

<script>
  import Son from "@/components/Son.vue";

  export default {
    components: {
      Son,
    },
    data() {
      return {
        sonMsg: 0
      };
    },
    methods: {
      getMsgFn(val) {
        // åŒæ­¥å­ç»„ä»¶ä¼ æ¥çš„æ•°æ®
        this.sonMsg = val
      }
    }
  };
</script>
```

### 3ã€å…„å¼Ÿé—´ä¼ æ•°æ®

&emsp;&emsp;åœ¨ <span style="background-color: yellow;color:black;">vue2.x</span> ä¸­ï¼Œå…„å¼Ÿç»„ä»¶ä¹‹é—´æ•°æ®å…±äº«çš„æ–¹æ¡ˆæ˜¯ <span style="color:red;">EventBus</span>ã€‚

&emsp;&emsp;ä¸å­ç»„ä»¶å‘çˆ¶ç»„ä»¶ä¼ é€æ•°æ®ä¸€æ ·ï¼Œä¸¤è€…éƒ½ä¼šç”¨åˆ°`$emit`ã€‚ä¸åŒçš„æ˜¯ï¼š

> ä¸€ä¸ªæ˜¯åŸºäºå½“å‰ vue å®ä¾‹çš„`this.$emit`ï¼Œ
> å¦ä¸€ä¸ªæ˜¯åŸºäº eventBus.js åˆ›å»ºçš„å…±äº« vue å®ä¾‹çš„ã€`bus.$emit`ã€âœ¨ `bus.$on`ã€‘ã€‚

- eventBus.js

```js
import Vue from 'vue'

// å‘å¤–å…±äº«Vueçš„å®ä¾‹å¯¹è±¡
export default new Vue()
```

- Send.vue

```html
<template>
  <div>
    <button @click="send_msg">å‘é€ä¿¡æ¯</button>
  <div>
</template>

<script>
  import bus from "./eventBus.js";

  export default {
    data() {
      return {
        msg: "å‘å…„å¼Ÿç»„ä»¶å‘é€æ•°æ®",
      };
    },
    methods: {
      send_msg() {
        // é€šè¿‡eventBuså‘é€æ•°æ®
        bus.$emit("share", this.msg);
      },
    },
  };
</script>
```

- Receive.vue

```html
<template>
  <div>
    <p>{{ get_msg }}</p>
  <div>
</template>

<script>
  import bus from "./eventBus.js";

  export default {
    data() {
      return {
        // æ¥æ”¶å…„å¼Ÿç»„ä»¶å‘é€çš„æ•°æ®
        get_msg: "",
      };
    },
    // åˆ©ç”¨ç”Ÿå‘½å‘¨æœŸå‡½æ•°ğŸš©è‡ªåŠ¨è§¦å‘è‡ªå®šä¹‰äº‹ä»¶
    created() {
      // é€šè¿‡eventBusæ¥æ”¶æ•°æ®
      bus.$on("share", (val) => {
        this.get_msg = val;
      });
    },
  };
</script>
```

## äºŒã€ref å¼•ç”¨

&emsp;&emsp;ref æ˜¯ç”¨æ¥è¾…åŠ©å¼€å‘è€…åœ¨ä¸ä¾èµ–äº jQuery çš„æƒ…å†µä¸‹ï¼Œè·å– DOM å…ƒç´ å’Œç»„ä»¶çš„å¼•ç”¨ã€‚

&emsp;&emsp;æ¯ä¸ª vue çš„ç»„ä»¶å®ä¾‹ä¸­ï¼Œéƒ½åŒ…å«ä¸€ä¸ª <span style="color:red;">\$refs å¯¹è±¡</span> ï¼Œ<span style="color:green;">é‡Œé¢å­˜å‚¨ç€å¯¹åº”çš„ DOM å…ƒç´ æˆ–ç»„ä»¶çš„å¼•ç”¨</span>ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œç»„ä»¶çš„`$refs`æŒ‡å‘ä¸€ä¸ªç©ºå¯¹è±¡ã€‚

```html
<template>
  <div>
    <button @click="showThis">æ‰“å°this</button>
  <div>
</template>
<script>
  export default {
    methods: {
      // æ€è€ƒä¸€ä¸‹ï¼Ÿæ˜¯å¦æ­£ç¡®
      showThis() {
        console.log(this);
      },
    },
  };
</script>
```

### 1ã€DOM å…ƒç´ ä¸­çš„ ref å¼•ç”¨

```html
<template>
  <div>
    <!-- å£°æ˜ä¸€ä¸ªDOMå…ƒç´ çš„âœ¨refå¼•ç”¨ -->
    <p ref="first_p">{{ headContent }}</p>

    <button @click="changeColor">æ”¹å˜DOMå…ƒç´ æ ·å¼</button>
  <div>
</template>

<script>
  export default {
    data() {
      return {
        headContent: 'æ¬¢è¿æ¥åˆ°refå¼•ç”¨çš„ä¸–ç•Œï¼',
      };
    },
    methods: {
      changeColor() {
        // $refså¯¹è±¡æœ‰ä¸Šé¢å£°æ˜çš„first_på±æ€§
        this.$refs.first_p.style.color = "red"
      }
    },
  }
</script>
```

### 2ã€vue ç»„ä»¶ä¸­çš„ ref å¼•ç”¨ ğŸš©

éœ€æ±‚ï¼š

> çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„æ–¹æ³•

- Ren.vue

```html
<template>
  <div>
    <!-- å£°æ˜ä¸€ä¸ªvueç»„ä»¶çš„âœ¨refå¼•ç”¨ -->
    <Son ref="comp_Son"></Son>

    <!-- é‡ç½®Sonå­ç»„ä»¶çš„countå€¼ä¸º0 -->
    <button @click="control_CountReset">é‡ç½®</button>
  <div>
</template>

<script>
  import Son from "@/components/Son.vue";

  export default {
    components: {
      Son,
    },
    methods: {
      control_CountReset() {
        // ï¼ˆç±»ä¼¼äºè·å–Sonå­ç»„ä»¶çš„å®ä¾‹å¯¹è±¡ã€thisã€‘ï¼‰
        console.log(this.$refs.comp_Son);

        this.$refs.comp_Son.countReset();
        this.$refs.comp_Son.count = 0;
      }
    }
  }
</script>
```

- Son.vue

```html
<template>
  <div>
    <p>æ•°å€¼å˜åŒ–ï¼š{{ count }}</p>
    <button @click="count += 1"> +1 </button>

    <button @click="countReset">é‡ç½®</button>
  <div>
</template>

<script>
  export default {
    data() {
      return {
        count: 0
      }
    },
    methods: {
      countReset() {
        this.count = 0
      }
    }
  },
</script>
```

### 3ã€ $nextTick() çš„ä½¿ç”¨

&emsp;&emsp;ç»„ä»¶çš„ <span style="color:red;">$nextTick(cb)</span> æ–¹æ³•ï¼Œä¼š<span style="color:green;">æŠŠ cd å›è°ƒæ¨è¿Ÿåˆ°ä¸‹ä¸€ä¸ª DOM æ›´æ–°å‘¨æœŸä¹‹åæ‰§è¡Œ</span>ã€‚å³ï¼šç»„ä»¶çš„ DOM æ›´æ–°å®Œæˆåï¼Œåœ¨æ‰§è¡Œ cb å›è°ƒå‡½æ•°ã€‚

- ä½œç”¨

> ä¿è¯ cb å›è°ƒå‡½æ•°å¯ä»¥æ“ä½œåˆ°æœ€æ–°çš„ DOM å…ƒç´ ã€‚

- æ¡ˆä¾‹

> è¾“å…¥æ¡†çš„æŒ‰éœ€å±•ç¤º

```html
<template>
  <div>
    <!-- å¯¹DOMå…ƒç´ ä½¿ç”¨refå¼•ç”¨ â€”â€” focus() -->
    <input type="text" v-if="inputShow" @blur="change_buttonShow" ref="input_ref">

    <button v-else @click="change_inputShow">å±•ç¤ºè¾“å…¥æ¡†</button></button>
  <div>
</template>

<script>
  export default {
    data() {
      return {
        // v-ifã€v-elseå®šä¹‰åˆå§‹çŠ¶æ€(inputæ¡†éšè—ï¼ŒbuttonæŒ‰é’®æ˜¾ç¤º)
        // æŠ€å·§ğŸ‰ï¼šçŠ¶æ€æ ‡è¯†å˜é‡
        inputShow: false
      }
    },
    methods: {
      // é€šè¿‡buttonçš„clickç‚¹å‡»äº‹ä»¶ â€”â€”> æ˜¾ç¤ºinputæ¡†
      change_inputShow() {
        this.inputShow = true

        // å‡çº§ï¼šæ˜¾ç¤ºinputæ¡†ã€åã€‘ğŸš©è‡ªåŠ¨è·å–ç„¦ç‚¹
        this.$nextTick(() => {
          this.$refs.input_ref.focus()
        })
      }

      // é€šè¿‡inputçš„blurç„¦ç‚¹äº‹ä»¶ â€”â€”> éšè—inputæ¡†
      change_buttonShow() {
        this.inputShow = false
      }
    }
  },
</script>
```

- æ€è€ƒ

> å¯ä»¥ç”¨å‘¨æœŸå‡½æ•° updated()ï¼Œæ¥ä»£æ›¿ $nextTick() å—ï¼Ÿ

## ä¸‰ã€æ‹“å±•ï¼ˆå®˜æ–¹ä¸å»ºè®®ä½¿ç”¨ï¼‰ï¼š

### 1ã€å¤„ç†è¾¹ç•Œ

- $root ï¼šè®¿é—®æ ¹å®ä¾‹ \*
- $parentï¼šè®¿é—®çˆ¶ç»„ä»¶çš„å®ä¾‹ \*
- <span style="color:red;">$refs</span>ï¼šè®¿é—®å­ç»„ä»¶çš„å®ä¾‹

### 2ã€ä¾èµ–æ³¨å…¥

&emsp;&emsp;åœ¨çˆ¶ç»„ä»¶åªè¦å£°æ˜äº†`provide`ï¼Œåœ¨å…¶å­ç»„ä»¶ï¼Œå­™ç»„ä»¶ï¼Œæ›¾å­™ç»„ä»¶ç­‰èƒ½å½¢æˆ<span style="color:green;">ä¸Šä¸‹æ¸¸å…³ç³»</span>çš„ç»„ä»¶ä¸­äº¤äº’ã€‚

> æ— è®ºå¤šæ·±éƒ½èƒ½é€šè¿‡`inject`æ¥è®¿é—®`provide`ä¸­çš„æ•°æ®ã€‚

- provide

```html
<template>
  <div>
    <p>{{ title }}</p>
    <son></son>
  </div>
</template>

<script>
  import Son from "./son"

  export default {
    name: 'Father',
    components: { Son },

    // provide æä¾›ç»™åä»£âœ¨ç»„ä»¶çš„æ•°æ®/æ–¹æ³•
    provide: {
      message: 'provided by father'
    },
    data () {
      return {
        title: 'çˆ¶ç»„ä»¶'
      }
    },
    methods: { ... }
  }
</script>
```

- è¿‡æ¸¡ï¼š

```html
<template>
  <div>
    <p>{{ title }}</p>
    <grand-son></grand-son>
  </div>
</template>
<script>
  import grandSon from './grandSon'

  export default {
    name: 'Son',
    components: { grandSon },
    data() {
      return {
        title: 'å­ç»„ä»¶'
      }
    }
  }
</script>
```

- inject

```html
<template>
  <div>
    <p>messageï¼š{{ message }}</p>
  </div>
</template>
<script>
  export default {
    name: "GrandSon",

    // ä½¿ç”¨ inject é€‰é¡¹æ¥æ¥æ”¶ç”±provideæä¾›çš„ã€å½“å‰ç»„ä»¶âœ¨éœ€è¦çš„æ•°æ®/æ–¹æ³•
    inject: [ "message" ],
    data () {
      return {
        title: 'å­™ç»„ä»¶'
      }
    },
    methods: { ... }
  };
</script>
```
